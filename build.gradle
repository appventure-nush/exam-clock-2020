plugins {
    id 'com.github.johnrengelman.shadow' version '5.2.0'
    id 'java'
}

group 'sg.edu.appventure'
version '1.3.3-beta'

repositories {
    mavenCentral()
}

dependencies {
    compile 'no.tornado:tornadofx-controls:1.0.4'
    compile 'org.nanohttpd:nanohttpd:2.3.1'
    compile 'com.google.zxing:core:3.4.0'
    compile 'com.google.zxing:javase:3.4.0'
    compile 'com.nimbusds:nimbus-jose-jwt:8.16'
    compile 'io.socket:socket.io-client:1.0.0'
    compile 'com.joestelmach:natty:0.13'
    compile group: 'com.dlsc.preferencesfx', name: 'preferencesfx-core', version: '8.6.0'
}

task generateTestSources {
    inputs.property "version", project.version
    outputs.dir "$buildDir/generated"
    doFirst {
        def versionFile = file("$buildDir/generated/sg/edu/appventure/examclock/Version.java")
        versionFile.parentFile.mkdirs()
        versionFile.text = """package sg.edu.appventure.examclock;public class Version {public static String getVersion() {return "$project.version";}}"""
    }
}

compileJava.dependsOn generateTestSources

sourceSets.main.java {
    srcDir "$buildDir/generated"
}

shadowJar.doLast {
    println "Deploying..."
    exec {
        commandLine 'sh', './build.sh'
    }
}


jar {
    manifest {
        attributes 'Main-Class': 'sg.edu.appventure.examclock.ExamClock'
    }
}